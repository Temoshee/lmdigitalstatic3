<!doctype html>
<html lang="en">
  <head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>CONTENTdm API Use | Your awesome title</title>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
<!-- built with CollectionBuilder-CONTENTdm https://github.com/CollectionBuilder/collectionbuilder-contentdm -->
<meta name="generator" content="collectionbuilder-contentdm" />
<meta http-equiv="Content-Language" content="en-us" >

<link rel="stylesheet" href="/assets/lib/bootstrap.min.css" type="text/css">
<script defer src="/assets/lib/fontawesome-free/js/all.min.js"></script>
<link rel="stylesheet" href="/assets/css/custom.css" type="text/css">



<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.">
<meta name="author" content="" >
<!-- Open Graph meta -->
<meta property="og:title" content="CONTENTdm API Use | Your awesome title" />
<meta property="og:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description." />
<meta property="og:site_name" content="Your awesome title" />
<meta property="og:type" content="website" />
<meta property="og:image" content="/assets/img/rise_and_progress_mi_david_marvin.jpg" />
<meta property="og:image:alt" content="CollectionBuilder logo" />
<meta property="og:url" content="/docs/contentdm-api.html" />
<meta property="og:locale" content="en_US" />
<!-- schema.org JSON-LD -->
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebPage","headline":"CONTENTdm API Use | Your awesome title","publisher":"","description":"Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.","image":"/assets/img/rise_and_progress_mi_david_marvin.jpg","url":"/docs/contentdm-api.html"}</script> 


<!-- Analytics --> 
<!-- Last build date: 2021-03-18 -->
  </head>
  <body>
    <div id="skip-to-content"><a href="#maincontent">Skip to main content</a></div>
    <div class="container">
    <div class="row align-items-center">
        <div id="title" class="col-md-9">
            <h1><a class="text-dark font-weight-normal" href="/" >Your awesome title</a></h1>	 
            
        </div>
        <div class="col-md-3 d-none d-lg-block text-right">
            <a class="btn btn-outline-light" href="" target="_blank" rel="noopener">
                <img class="img-fluid" src="" title="" alt=" home" >
            </a>
        </div>
    </div>
</div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#page-nav" aria-controls="page-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <span class="d-lg-none text-right">
            <a href="" target="_blank" rel="noopener">
                <img class="img-fluid" id="mobile-nav-image" src="" title="" alt=" home" >
            </a>
        </span>

        <div class="collapse navbar-collapse" id="page-nav">
            <ul class="navbar-nav mr-auto">
                
                <li class="nav-item ">
                    <a class="nav-link " href="/">Home</a>
                </li>
                
                <li class="nav-item ">
                    <a class="nav-link " href="/timeline.html">Timeline</a>
                </li></ul>
            <script>
    function site_search() {
        var query = document.getElementById("site-search").value
        window.open("/browse.html#" + encodeURIComponent(query), "_self" );
    }
</script>
<form class="form-inline my-2 my-lg-0" role="search" id="nav-search" onsubmit="site_search(); return false;">
    <div class="input-group">
        <input id="site-search" class="form-control " type="text" placeholder="Search" aria-label="Search box">
        <div class="input-group-append">
            <button class="btn btn-light" type="submit">
                <span id="search-icon"><svg viewBox="0 0 1024 974" height="16px" width="20px"><path d="M960 832L710.875 582.875C746.438 524.812 768 457.156 768 384 768 171.96900000000005 596 0 384 0 171.969 0 0 171.96900000000005 0 384c0 212 171.969 384 384 384 73.156 0 140.812-21.562 198.875-57L832 960c17.5 17.5 46.5 17.375 64 0l64-64C977.5 878.5 977.5 849.5 960 832zM384 640c-141.375 0-256-114.625-256-256s114.625-256 256-256 256 114.625 256 256S525.375 640 384 640z"/></svg></span>
                <span class="sr-only">Search Objects</span>
            </button>
        </div>
    </div>
</form>
        </div>
    </div>    
</nav>

    <main id="maincontent" role="main">
      <div class="container mt-4">
  <h1 id="contentdm-api-use">CONTENTdm API Use</h1>

<p>CollectionBuilder-CONTENTdm uses CONTENTdm API to retrieve display images and file downloads from the repository. 
In general, it uses IIIF for image objects and CDM “utils” API for non-image items.</p>

<p>Page templates typically check if an item is an image or not. 
If it is an image, it uses the HTML recipes for the IIIF image API calls in <code class="language-plaintext highlighter-rouge">_includes/image</code>.
The recipes assume it is being called by a page-gen page or loop through items (with the iteration variable named <code class="language-plaintext highlighter-rouge">item</code>), where full item metadata is available so that it can access <code class="language-plaintext highlighter-rouge">cdmid</code>. 
If the item is not an image, the templates default to GetThumbnail util API.</p>

<p>The JS version of the recipes is manually encoded in the JS includes (in browse-js.html, carousel-js.html, map-js.html), which must be updated separately.</p>

<p>Currently, the image includes use <code class="language-plaintext highlighter-rouge">pct:</code> with % set in the theme.yml, e.g. large <code class="language-plaintext highlighter-rouge">pct:70</code>. 
This works consistently with most collections, unless the images in CDM are abnormally large or small (see CDM IIIF Issues below for limitations). 
However, using % can be a bit random since you don’t know the starting size. 
Secondly, CDM does not seem to allow less than 10%.</p>

<p>The carousel include uses just the height, <code class="language-plaintext highlighter-rouge">,h</code> based on the height of the carousel set in theme.yml. 
This ensures the image makes sense in that location, but can end up with odd sizes for images with extreme ratios, large landscape or large vertical images.</p>

<h2 id="contentdm-api-reference">CONTENTdm API reference</h2>

<ul>
  <li><a href="https://www.oclc.org/support/services/contentdm/help/customizing-website-help/other-customizations/contentdm-api-reference.en.html">CONTENTdm API reference</a></li>
  <li><a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/API_Reference/IIIF_API_reference">CONTENTdm IIIF API reference</a></li>
  <li><a href="https://iiif.io/api/image/2.1/">IIIF Image API 2.1.1</a></li>
</ul>

<h2 id="cdm-utls">CDM utls</h2>

<p>This API is unique to CONTENTdm and used to get image and file downloads from the repository.
CollectionBuilder uses these calls:</p>

<ul>
  <li><a href="https://www.oclc.org/support/services/contentdm/help/customizing-website-help/other-customizations/contentdm-api-reference/getthumbnail.en.html#par_text_4c0f">GetThumbnail</a> - will provide a thumb for any object in the repository. <code class="language-plaintext highlighter-rouge">/utils/getthumbnail/collection/alias/id/pointer</code></li>
  <li><a href="https://www.oclc.org/support/services/contentdm/help/customizing-website-help/other-customizations/contentdm-api-reference/getfile.en.html#par_text_6545">GetFile</a> - provides a download link for PDF objects, <code class="language-plaintext highlighter-rouge">/utils/getfile/collection/alias/id/pointer/filename/name</code></li>
  <li><a href="https://www.oclc.org/support/services/contentdm/help/customizing-website-help/other-customizations/contentdm-api-reference/getstream.en.html#par_text_2d39">GetStream</a> - provides download and playable link for video/audio objects, <code class="language-plaintext highlighter-rouge">/utils/getstream/collection/alias/id/pointer</code></li>
</ul>

<h2 id="iiif">IIIF</h2>

<p>CONTENTdm supports IIIF API for images only (i.e. won’t work with an object that is a PDF file or video, etc).</p>

<p>IIIF standard looks like: 
<code class="language-plaintext highlighter-rouge">{scheme}://{server}{/prefix}/{identifier}/{region}/{size}/{rotation}/{quality}.{format}</code></p>

<p>Which looks like this in CDM: 
<code class="language-plaintext highlighter-rouge">https://cdm17254.contentdm.oclc.org/digital/iiif/psychiana/548/full/pct:50/0/default.jpg</code></p>

<p>Get max size:
<code class="language-plaintext highlighter-rouge">https://cdm17254.contentdm.oclc.org/digital/iiif/psychiana/548/full/max/0/default.jpg</code></p>

<p>Get image info example: <code class="language-plaintext highlighter-rouge">https://cdm17254.contentdm.oclc.org/digital/iiif/psychiana/548/info.json</code></p>

<h2 id="cdm-iiif-issues">CDM IIIF Issues</h2>

<p>CONTENTdm implementation of IIIF has some limitations:</p>

<ul>
  <li>using the Size parameter <code class="language-plaintext highlighter-rouge">!w,h</code> does not work, instead returns <code class="language-plaintext highlighter-rouge">max</code> instead.</li>
  <li>using the Size parameter <code class="language-plaintext highlighter-rouge">pct:</code> with less than 10% does not work, and will return an error message.</li>
  <li>if either pixel size used in Size parameter <code class="language-plaintext highlighter-rouge">w,h</code> is larger than actual dimension of the full image, it will return an error message.</li>
</ul>

<p>Given these limits, we have used <code class="language-plaintext highlighter-rouge">pct:</code> in most API calls, since it is the least likely to break. 
However, this means that if the originals in CDM are abnormally large or small, you will want to adjust the % used in the theme.yml. 
With collections that have multiple scan qualities, this may still result in inconsistent image sizes in the visualizations and many require experimentation with the API to resolve.</p>

</div>
    </main>
    <footer class="bg-dark pt-4 container-fluid mt-3">

    <div class="row border-bottom border-white pb-4 mb-2">

        <div class="col-md-7  px-4 mt-2">

            <p class="text-white">
            <a href="https://www.michigan.gov/lawlibrary">
                Library of Michigan<br>
                State Law Library<br>
                702 West Kalamazoo St.<br>
                Lansing MI 48909<br>
                lmlawlib@michigan.gov<br>
            </a>
            </p>

        </div>

        <div class="col-md-5 mt-2 text-right">

            <p class="text-right">
                <a href="" target="_blank" rel="noopener">
                    <img class="img-fluid" src="" alt=" home">
                </a>
            </p>
            <p class="text-white" id="footer-credits">
                <small><em>built with</em>
                    <a href="https://collectionbuilder.github.io/" target="_blank" rel="noopener" title="CollectionBuilder">
                        <img src="/assets/img/collectionbuilder-logo.png" class="img-fluid" alt="CollectionBuilder home" >
                    </a>
                </small>
            </p>

        </div>

    </div>

    <div class="col-md-12 text-center pt-3 pb-1">
        <p class="text-white">Last updated 2021</p>
    </div>

</footer>
    <!-- Optional JS for Bootstrap: jQuery first, then Bootstrap bundle JS -->
<script src="/assets/lib/jquery-3.5.1.min.js"></script>
<script src="/assets/lib/bootstrap.bundle.min.js"></script>
<!-- load other js -->
<script src="/assets/lib/lazysizes.min.js" async></script>









    <script>
    // When the user scrolls down from the top of the document, show the button
    window.onscroll = function () {
        if (document.body.scrollTop > 500 || document.documentElement.scrollTop > 500) {
            document.getElementById("scroll-to-top").style.display = "block";
        } else {
            document.getElementById("scroll-to-top").style.display = "none";
        }
    }
    // scroll to top function
    function scrollToTop() {
        $('html, body').animate({scrollTop: 0}, 750);
    }
</script>
<button id="scroll-to-top" type="button" class="btn btn-link btn-lg" onclick="scrollToTop();" title="Back to Top" aria-label="Back to Top">
    <span class="fa fa-angle-double-up fa-stack-1x" ></span>
</button>
  </body>
</html>